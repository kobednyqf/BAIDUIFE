<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>IFE JavaScript Task 01</title>
    <style>input{width: 80px}</style>
    <style>#arr{background-color: #eeeeee;font-size:0.5em;line-height:2em}</style>
  </head>
<body>
  <span>
    <label>城市</label><input max-length="3" id="city">
  </span>
  <span>
    <label>空气质量</label><input max-length="3" id="air">
  </span>
  <button id="bt">PUSH</button>
  <p id="arr">数组</p>
  <h3>空气质量排名</h3>
  <ul id="aqi-list">
  </ul>

<script type="text/javascript">

var aqiData = [
  ["北京", 20],
  ["上海", 30],
  ["福州", 80],
  ["深圳", 90],
  ["西雅图", 95],
  ["广州", 35],
  ["成都", 40],
  ["西安", 50]
];

var city = document.getElementById("city");
var air = document.getElementById("air");
var bt = document.getElementById("bt");
var arr = document.getElementById("arr");
var ul = document.getElementById("aqi-list");

function addEvent(element,event,listener){
  if(element.addEventListener){
      element.addEventListener(event,listener,false);//不捕获
  }
  else if(element.attachEvent){
      element.attachEvent("on"+event,listener);
  }
  else{
      element["on"+event] = listener;
  }
}

function init(){
  city.value ="";
  air.value = "";
  arr.innerHTML = JSON.stringify(aqiData);
};

function isCity(name){
  var reg = /^[\u4e00-\u9fa5]{1,10}$/;
  return reg.test(name);
}

function isAir(num){
  var reg = /^(0|[1-9][0-9]|100*)$/;
  return reg.test(num);
}

function getData(){
  sortData(aqiData);//先快速排序
  aqiData.reverse();//再取反方向
  ul.innerHTML="";//初始化
  var j = 1;
  for(var i in aqiData){
    if(aqiData[i][1]>60){
      var p = document.createElement("p");
      p.innerHTML = "第" + (j++) + "名" + " " + aqiData[i][0] + " " + aqiData[i][1] +" ";
      ul.appendChild(p);
    }
  }
}

function qsort(arr,left,right){
  var i,j,t,temp;
  if(left>right)
    return arr;
  temp = arr[left][1];
  i=left;
  j=right;
  while(i!=j){

    while(arr[j][1]>=temp && i<j)
      j--;

    while(arr[i][1]<=temp && i<j)
      i++;

    if(i<j){
      t = arr[i][0];
      arr[i][0]=arr[j][0];
      arr[j][0] = t;
      t = arr[i][1];
      arr[i][1]=arr[j][1];
      arr[j][1] = t;
    }
  }
  arr[left][1] = arr[i][1];
  arr[i][1] = temp;
  temp = arr[left][0];
  arr[left][0] = arr[i][0];
  arr[i][0] = temp;

  qsort(arr,left,i-1);
  qsort(arr,i+1,right);
}

function sortData(arr){
  qsort(arr,0,arr.length-1);
}


(function () {

  /*
  在注释下方编写代码
  遍历读取aqiData中各个城市的数据
  将空气质量指数大于60的城市显示到aqi-list的列表中
  */
  getData();
  init();

  addEvent(bt,"click",function(){
    var c = city.value;
    var a = air.value;
    if(isCity(c)&&isAir(a)){
      aqiData.push([c,a]);
      getData();
      init();
    }
  })

})();

</script>
</body>
</html>