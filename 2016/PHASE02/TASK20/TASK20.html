<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>IFE JavaScript Task 20</title>
    <style>input{width: 80px}</style>
    <style>#arr{background-color: #eeeeee;font-size:0.5em;line-height:2em}</style>
    <style>
    #aqi-list p a{
      text-decoration:none;
      color:red;padding: 0 0.5em;
      line-height: 1em;
      font-size: 1em
    }
    body,a,input,p,span,textarea{
      font-family: "Helvetica Neue", "Luxi Sans", "DejaVu Sans", Tahoma, "Hiragino Sans GB", "Microsoft Yahei", sans-serif;
    }
    body{margin: 0;}
    body .wrap{margin: 10px}
    .alert{
      color: white;
      text-align: center;
      background-color: #D85151;
      position: fixed;
      width: 100%;
      bottom: 0;
    }
    #arr button{
      border: none;
      background-color: white;
      margin: 0 10px;
      padding: 1px 3px;
    }
    .gui{
      position: relative;
      height: 400px;
      width: 80%;
      margin:10px 10%;
      text-align: center;
    }
    .gui div{
      padding-top: 10px;
      position: absolute;
      bottom: 0;
      display: block;
      bottom: 0;
      overflow-y:hidden;
      overflow-wrap:break-word;
    }
    .gui div span{color: white;font-weight: bold}
    textarea{
      display: block;
      resize:none;
      width: 60%;
      margin: 10px 0;
    }
    </style>
  </head>
<body>
<div class="wrap">
  <span>
    <label></label><textarea id="air"></textarea>
  </span>
  <button id="lpush">左压入</button>
  <button id="rpush">右压入</button>
  <button id="lpop">左弹出</button>
  <button id="rpop">右弹出</button>
  <!--<button id="guiQsort">快速排序</button>-->
  <button id="search">查询</button>
  <p id="arr">数组</p>
</div>
<div class="gui">
</div>
<script type="text/javascript">
var flag;
var aqiData = ['10','20','google','tencent','python','JS','ES6','百度ife'];

var air = document.getElementById("air");
var lpush = document.getElementById("lpush");
var rpush = document.getElementById("rpush");
var lpop = document.getElementById("lpop");
var rpop = document.getElementById("rpop");
var arr = document.getElementById("arr");
var search = document.getElementById("search");
var guiQsort = document.getElementById("guiQsort");

function addEvent(element,event,listener){
  if(element.addEventListener){
      element.addEventListener(event,listener,false);//不捕获
  }
  else if(element.attachEvent){
      element.attachEvent("on"+event,listener);
  }
  else{
      element["on"+event] = listener;
  }
}

function gui(arr){
  var gui = document.getElementsByClassName("gui")[0];
  var helper = [];
  var l = arr.length;
  var rainbow = ['#9DCBF9','#89C0F7','#77B6F5','#4E94DA','#3F8BD6','#3B80C5','#3F8BD6','#4E94DA','#77B6F5','#89C0F7'];
  var j=0;
  for(var i in arr){
    if(j==10){j=0};
    helper.push("<div style=\"");
    helper.push("background-color:" +rainbow[j++]+ ";");
    helper.push("height:" +(100-90/l)+ "%;");
    helper.push("width:" +90/l+ "%;");
    helper.push("margin-left:" +(-45/l)+ "%;");
    helper.push("left:" +(50+(i-0.5*l+0.5)*100/l)+ "%;");
    helper.push("\">"+arr[i]+"</div>");
  }
  gui.innerHTML = helper.join('');
}




function init(){
  air.value = "";
  arr.innerHTML="";
  for(var i=0;i<aqiData.length;i++){
    arr.innerHTML += "<button onclick=\"pop("+i+")\">"+aqiData[i]+"</button>"
  }
  gui(aqiData);
};


function isAir(num){
  if(!num instanceof Array)
    return false;
  var reg = /^([0-9a-zA-Z-_\u4e00-\u9fa5]){1,}$/;
  for(var i in num){
    if(!reg.test(num[i]))
      return false;
  }
  return true;
}

function pop(index){
  var newarr = [];
  for(var i=0;i<aqiData.length;i++){
    if(i==index){
      continue;      
    }
    else{
      newarr.push(aqiData[i]);
    }
  }
  aqiData = newarr;
  init();
}

function sortAqiData(data) {
  data.sort(function(a,b){
    return b-a;
  })//从高到低
  return data;
}

function qsort(arr,left,right){
  var i,j,t,temp;
  if(left>right)
    return true;
  temp = arr[left];
  i=left;
  j=right;
  while(i!=j){

    while(arr[j]>=temp && i<j)
      j--;
    while(arr[i]<=temp && i<j)
      i++;

    if(i<j){
      t = arr[i];
      arr[i] = arr[j];
      arr[j] = t;
      init();
    }
  }

  arr[left] = arr[i];
  arr[i] = temp;
  init();
  function l(){qsort(arr,left,i-1);}
  function r(){qsort(arr,i+1,right);}
  setTimeout(l,100);
  setTimeout(r,100);
}



(function () {

  /*
  在注释下方编写代码
  遍历读取aqiData中各个城市的数据
  将空气质量指数大于60的城市显示到aqi-list的列表中
  */
  init();

  addEvent(lpush,"click",function(){
    var a = trimArray(fordivide(air.value));
    //预清除
    if(flag==1){
      var alertNode = document.getElementsByClassName("alert")[0];
      document.body.removeChild(alertNode);
      flag = 0;
    }
    if(isAir(a)){
      aqiData.reverse();
      for(var i in a){
        aqiData.push(a[i]);
      }
      aqiData.reverse();
      init();
      return true;
    }
    //fault
    if(!isAir(a)){
      error();
      return false;
    }
  })

  addEvent(rpush,"click",function(){
    var a = trimArray(fordivide(air.value));
    //预清除
    if(flag==1){
      var alertNode = document.getElementsByClassName("alert")[0];
      document.body.removeChild(alertNode);
      flag = 0;
    }
    if(isAir(a)){
      for(var i in a){
        aqiData.push(a[i]);
      }
      init();
      return true;
    }
    //fault
    if(!isAir(a)){
      error();
      return false;
    }
  })

  addEvent(lpop,"click",function(){
    //预清除
    if(flag==1){
      var alertNode = document.getElementsByClassName("alert")[0];
      document.body.removeChild(alertNode);
      flag = 0;
    }

    aqiData.reverse();
    aqiData.pop();
    aqiData.reverse();
    init();
    return true;

  })

  addEvent(rpop,"click",function(){
    //预清除
    if(flag==1){
      var alertNode = document.getElementsByClassName("alert")[0];
      document.body.removeChild(alertNode);
      flag = 0;
    }

    aqiData.pop();
    init();
    return true;

  })

  addEvent(search,"click",function(){
    var a = air.value;
    //预清除
    if(flag==1){
      var alertNode = document.getElementsByClassName("alert")[0];
      document.body.removeChild(alertNode);
      flag = 0;
    }

    if(isAir(a)){
      searchGui(a);
      return true;
    }

    if(!isAir(a)){
      error();
      return false;
    }

  })



})();

function error(){
      var div = document.createElement('div');
      div.innerHTML = "<p>请输入数字/中文/英文/下划线组合哦</p>";
      div.setAttribute("class","alert");
      document.body.appendChild(div);
      flag = 1;
      addEvent(div,'click',function(){
        document.body.removeChild(div);
        flag = 0;
      })
}


//数组去空  
function trimArray(arr){
  var newarr=[]
  for(var i=0;i<arr.length;i++){
    var node = arr[i].replace(/ /ig,"");
    if(node.length<=0)
      continue
    else
      newarr.push(node);
  }
  return newarr;
}

function fordivide(str){
  var arr=[];
  arr[0]="";    
  if(!str)
    return false;
  else{
    for(var j=0,i = 0;i<str.length;i++){
      if(str[i]!=";"&&str[i]!=" "&&str[i]!=","&&str[i]!="`"&&str[i]!="\n"&&str[i]!="，"&&str[i]!="；"){
        arr[j]+=str[i];
      }
      else if(str[i]==";"||str[i]==" "||str[i]==","||str[i]=="`"||str[i]=="\n"||str[i]=="，"||str[i]=="；"){
        arr[++j]="";
      }
    }
  }
  return arr;
}

//
function searchGui(x){
  gui(aqiData);
  //预处理
  var oldData = aqiData;
  var newData = [];
  for(var i=0;i<oldData.length;i++){
    //查询是否存在
    var node = oldData[i].replace(x,'<span>'+x+'</span>');
    newData.push(node);
    //直接返回span的innerHTML
  }
  gui(newData);
  //再次GUI
}
</script>
</body>
</html>